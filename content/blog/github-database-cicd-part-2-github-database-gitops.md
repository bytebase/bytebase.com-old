---
title: "How to Setup Database CI/CD with GitHub, Part 2: GitHub.com Database GitOps"
author: Ningjing
published_at: 2022/9/6 13:00:00
feature_image: /static/blog/github-database-cicd-part-2-github-database-gitops/howto-github-2.webp
tags: Education
featured: true
description: This second part will guide you through configuring GitHub.com database GitOps with Bytebase. After following these steps, you can trigger database changes by merging sql files into your GitHub repository.
---

This is a series of articles about Database CI/CD with GitHub

- [The Database CI/CD Best Practice with GitHub](/blog/database-cicd-best-practice-with-github)

- How to Setup Database CI/CD with GitHub Part 1-3
  - [Part 1: Enable SQL Review with GitHub Actions](/blog/github-database-cicd-part-1-sql-review-github-actions)
  - Part 2: GitHub.com Database GitOps (this one)
  - [Part 3: Put Them Together](/blog/github-database-cicd-part-3-put-them-together)

---

In the last article [How to Setup Database CI/CD with GitHub, Part 1: Enable SQL Review with GitHub Actions](/blog/github-database-cicd-part-1-sql-review-github-actions), you learned how to enable SQL review GitHub actions and trigger it automatically when there is a pull request in your repo.

This second part will guide you through configuring GitHub.com database GitOps with Bytebase. After following these steps, whenever SQL files carrying the database change are merged into your GitHub repository, the database change pipeline will be automatically triggered. Thus your Git repository always keeps the source of truth of your database schema, and your live database schema always evolves whenever SQL files change in the Git repository.

![divided-workflow](/static/blog/github-database-cicd-part-2-github-database-gitops/divided-workflow.webp)

## Step 1 - Run Bytebase in Docker with the URL generated by ngrok

In this tutorial, you’ll run Bytebase locally using Docker.

[ngrok](https://ngrok.com/) is a reverse proxy tunnel, and in our case, we need it for a public network address in order to receive webhooks from GitHub.com. ngrok we used here is for demonstration purposes. For production use, we recommend using [Caddy](https://caddyserver.com/).

![ngrok-reverse-proxy](/static/blog/github-database-cicd-part-2-github-database-gitops/ngrok-reverse-proxy.webp)

1. Login to [ngrok Dashboard](https://dashboard.ngrok.com/get-started/setup) and follow its **Getting Started** steps to install and configure.
2. Run `ngrok http 8080` and obtain the public URL:

![ngrok](/static/blog/github-database-cicd-part-2-github-database-gitops/ngrok.webp)

3. Run Bytebase in Docker with the following command.

```bash
docker run --init \
--name bytebase-github \
--restart always \
--publish 8080:8080 \
--volume ~/.bytebase/data:/var/opt/bytebase \
bytebase/bytebase:1.3.0 \
--data /var/opt/bytebase \
--external-url https://03f1-103-102-7-52.ngrok.io \
--port 8080 \
--frontend-port 80
```

4. Bytebase is running successfully in Docker, and you can visit it via [https://03f1-103-102-7-52.ngrok.io](https://03f1-103-102-7-52.ngrok.io/)

![docker-running](/static/blog/github-database-cicd-part-2-github-database-gitops/docker-running.webp)

## Step 2 - Add GitHub.com as a Git provider in Bytebase

1. Open Bytebase, go to **Settings** > **Version Control**, choose **GitHub.com**, and click **Next**.

![bb-vc](/static/blog/github-database-cicd-part-2-github-database-gitops/bb-vc.webp)

2. Copy the **Authorization callback URL**.

![fill-id-secret](/static/blog/github-database-cicd-part-2-github-database-gitops/fill-id-secret.webp)

3. Open GitHub, and go to **Settings > Developer Settings > OAuth Apps**. Click **New OAuth App**.
   ![github-oauth](/static/blog/github-database-cicd-part-2-github-database-gitops/github-oauth.webp)

4. Scroll down on the new OAuth App page, paste the **Authorization callback URL**, then click **Update Application**.

![auth-callback](/static/blog/github-database-cicd-part-2-github-database-gitops/auth-callback.webp)

5. On the same page, you can also find **Client ID** and **Client secrets**.

![client-id-secrets](/static/blog/github-database-cicd-part-2-github-database-gitops/client-id-secrets.webp)

6. Switch back to the Bytebase console, fill Client ID and Client secrets in the form as **Application ID** and **Secret**.

![fill-id-secret](/static/blog/github-database-cicd-part-2-github-database-gitops/fill-id-secret.webp)

6. Click **Next**. You will be redirected to the confirmation page. Click **Confirm and add**, and the Git provider is successfully added.

![confirm-and-add](/static/blog/github-database-cicd-part-2-github-database-gitops/confirm-and-add.webp)

## Step 3 - Use GitOps workflow to apply Schema Change

1. Go to **Instances** to add two instances for **Test** and **Prod** environments respectively. In our case, we use two AWS RDS MySQL instances with the same employee data set.

- If you don’t have any database to use, check our docs to [run MySQL in docker](/docs/get-started/install/local-mysql-instance).
- We also open sourced the sample employee data set for MySQL, which you can import: [https://github.com/bytebase/employee-sample-database-mysql](https://github.com/bytebase/employee-sample-database-mysql). If you don't import this, you can also create databases and tables manually for your needs.

![add-two-instances](/static/blog/github-database-cicd-part-2-github-database-gitops/add-two-instances.webp)

2. Create a Project, click **Transfer in DB** and choose two identical databases belonging to **Test** and **Prod** environments respectively.

![transfer-in-db](/static/blog/github-database-cicd-part-2-github-database-gitops/transfer-in-db.webp)

![transfer-in-db-2](/static/blog/github-database-cicd-part-2-github-database-gitops/transfer-in-db-2.webp)

3. Go to **Version Control** under the project, and choose **GitOps workflow**.

![project-vc](/static/blog/github-database-cicd-part-2-github-database-gitops/project-vc.webp)

![project-vc-2](/static/blog/github-database-cicd-part-2-github-database-gitops/project-vc-2.webp)

4. Create a repository named `database-gitops-sample` in GitHub. Select this repository in Bytebase. Keep the default setting unless you know what you are doing. Pay attention to **Branch** field to make sure it’s the one you want to watch.

![project-repo](/static/blog/github-database-cicd-part-2-github-database-gitops/project-repo.webp)

5. Click **Finish**, and you can see that Version Control is **enabled**.

![vc-enable](/static/blog/github-database-cicd-part-2-github-database-gitops/vc-enable.webp)

6. Create a **bytebase** folder and **prod**, **test** folders under it in your GitHub repository.

![bytebase-folder](/static/blog/github-database-cicd-part-2-github-database-gitops/bytebase-folder.webp)

7. Create a sql script following the name convention `{{ENV_NAME}}/{{DB_NAME}}##{{VERSION}}##{{TYPE}}##{{DESCRIPTION}}.sql`, and here we create `employeeGitHub##202208171630##ddl##add_nickname.sql` under the `test` directory.

- `test` corresponds to {{ENV_NAME}}
- `employeeGitHub` corresponds to {{DB_NAME}}
- `202208171630` corresponds to {{VERSION}}
- `ddl` corresponds to {{TYPE}}
- `add_nickname` corresponds to {{DESCRIPTION}}

![create-migration-sql](/static/blog/github-database-cicd-part-2-github-database-gitops/create-migration-sql.webp)

8. Commit and push this script.
9. Go back to the Bytebase Console, and you can see there is a new issue created.

![new-issue](/static/blog/github-database-cicd-part-2-github-database-gitops/new-issue.webp)

10. Visit this issue, and click **Approve**. The SQL will execute against the `employeeGitHub` database in the `Test` environment, and it shows **Done**. You may also [configure the environment](/docs/get-started/configure-workspace/set-up-environments) to skip this manual approval step.

![issue-waiting](/static/blog/github-database-cicd-part-2-github-database-gitops/issue-waiting.webp)
![issue-done](/static/blog/github-database-cicd-part-2-github-database-gitops/issue-done.webp)

11. Go to database **employeeGitHub** > table **employee**, and the nickname column is added there.

![table-employee](/static/blog/github-database-cicd-part-2-github-database-gitops/table-employee.webp)

12. Switch to your code editor, and you will find there is an auto-generated file `.employeeGitHub##LATEST.sql`, which is the latest schema written back by Bytebase.
    ![latest](/static/blog/github-database-cicd-part-2-github-database-gitops/latest.webp)

1.  Copy the migration script file `employeeGitHub##202208171630##ddl##add_nickname.sql` and paste it into `prod` directory, and repeat the process. The schema change will execute on **Prod** environment.

Congratulations! Now you have 1) Enabled SQL Review GitHub Actions for your GitHub repo, 2) Tried out database GitOps with GitHub. In the upcoming final part, we’ll put these two together, and thus, implementing a complete database CI/CD workflow.

Ready to try out this workflow yourself? Join our [Discord channel](https://discord.gg/6JYYBXvMDF) and share your experience.
